{"version":3,"sources":["../../src/pages/game/game.module.ts","../../src/pages/game/game.ts","../../node_modules/rxjs/add/operator/map.js"],"names":[],"mappings":"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","file":"0.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { GamePage } from './game';\n// import { ComponentsModule } from '../../components/components.module'\n\n@NgModule({\n  declarations: [\n    GamePage,\n    \n  ],\n  imports: [\n    IonicPageModule.forChild(GamePage),\n    // ComponentsModule\n  ],\n\n})\nexport class GamePageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/game/game.module.ts","import { Component } from '@angular/core';\nimport { IonicPage, NavController, NavParams, Platform, AlertController, ViewController } from 'ionic-angular';\nimport { AngularFireDatabase } from 'angularfire2/database';\nimport { AuthService } from '../../services/auth.service';\nimport { RoomsService } from '../../services/rooms.service';\nimport {CategoryModel } from '../../Models/category.model';\nimport { ChangeDetectorRef } from '@angular/core';\nimport { LoadingController } from 'ionic-angular';\nimport { MessagesService } from '../../services/messages.service';\nimport 'rxjs/add/operator/map';\nimport { DateTime } from 'ionic-angular/components/datetime/datetime';\n\n@IonicPage()\n@Component({\n  selector: 'page-game',\n  templateUrl: 'game.html',\n})\nexport class GamePage {\n  roomKey: string;\n  photoImage: string;\n  subjectTitle: string;\n  categoryTitle: string;\n  isSpy: Boolean;\n  roundKey: string;\n  second: number = 0;\n  min: number;\n  id: any;\n  loader: any;\n  lastSeconds: boolean;\n  secLabel: string = \"0\";\n  alert: any;\n  startTime;\n  currentTime;\n  dateTime: Date = new Date();\n\n  constructor(public navCtrl: NavController, public navParams: NavParams,  public af: AngularFireDatabase,\n              private authService: AuthService, private roomsService: RoomsService, private cd : ChangeDetectorRef,\n              public platform: Platform, public alertCtrl: AlertController, public loadingCtrl: LoadingController,\n              public viewCtrl: ViewController, public msgService: MessagesService) {\n    \n    // save the start date \n    this.startTime = this.dateTime.getTime();\n\n    this.roundKey = this.navParams.get('roundKey');\n    \n    let subscription =this.af.object(`rounds/${roomsService.currentRoom.$key}/${this.roundKey}`).subscribe( round => {\n      if(round.spyKey == this.authService.currentUser.$key){\n        this.drawSpy(round.categoryKey);\n        subscription.unsubscribe();\n      }\n      else {\n        this.drawRandomCard(round.secret, round.categoryKey);\n        subscription.unsubscribe();\n      }\n      // set the spy so we could know him in the future\n      this.roomsService.setSpy(round.spyKey);\n    });\n\n    this.af.object(`/settings/${roomsService.currentRoom.settingsKey}`).subscribe( set=> {\n      //this.min = set.timeElapsed;\n      this.startTime += set.timeElapsed * 60000;\n    });\n\n    this.id = setInterval(()=> {\n      var date: Date = new Date();\n      var currTime = this.startTime - date.getTime();\n      this.second = new Date(currTime).getSeconds();\n      this.min = new Date(currTime).getMinutes();\n\n      if(this.second <= 9 && this.second >= 0) {\n           this.secLabel = \"0\" + this.second;\n         }\n      else {\n           this.secLabel = this.second.toString();\n         }\n       \n      if(this.second == 30 && this.min == 0)\n        this.lastSeconds = true;\n       if((this.second == 0 && this.min == 0) || this.min < 0) {\n         this.LeaveGame();\n       }\n       cd.markForCheck();\n    }, 1000); \n  }\n\n  ionViewWillLeave() {\n    clearInterval(this.id);\n  }\n\n  private addPointsToSpy(spyState: string) {\n    let points =0;\n    switch(spyState) {\n      case \"win\":\n        points = 5;\n        break;\n      case \"semi-win\":\n        points = 3;\n        break;\n    }\n\n    this.authService.currentUser.pointsInRoom += points;\n    this.af.object(`/rooms/${this.roomsService.currentRoom.$key}/users/${this.authService.currentUser.$key}`).set(this.authService.currentUser.pointsInRoom);\n  }\n\n  private drawRandomCard(subject: number, categoryKey: string) {\n    this.af.object(`categories/${categoryKey}/`).subscribe( category =>{\n      let catModel: CategoryModel = category;\n      this.categoryTitle = catModel.title;\n      this.photoImage = catModel.members[subject].url; \n      this.subjectTitle = catModel.members[subject].title; \n    });\n  }\n  \n  private drawSpy(categoryKey: string) {\n    this.af.object(`categories/${categoryKey}/`).subscribe( category =>{\n      this.categoryTitle = category.title;\n    });\n\n    this.photoImage = \"assets/spy2.png\";\n    this.subjectTitle = \"Spy\";\n    this.isSpy = true;\n\n    // wait till other users will vote\n    if(this.isSpy) {\n      this.af.object(`rounds/${this.roomsService.currentRoom.$key}/${this.roundKey}/spyState`).subscribe(spy =>{\n          console.log(\"the state is \" + spy.$value);\n        if(spy.$value == \"found\") {\n          this.dismissLoading();\n          // go to guess subject page\n          clearInterval(this.id);\n\n          this.navCtrl.push(\"GuessPage\", { roundKey: this.roundKey });\n        }\n        else if(spy.$value == \"win\" || spy.$value == \"semi-win\" || spy.$value == \"lose\") {\n          this.dismissLoading();\n          clearInterval(this.id);\n          this.addPointsToSpy(spy.$value);\n          // go to score page \n          this.navCtrl.push('ScorePage',  { roundKey: this.roundKey, spyState: spy.$value });\n        }\n        else if(spy.$value == \"damaged\") { // preserve for times when some of the players leave the room\n          clearInterval(this.id);\n          this.dismissLoading();\n\n          this.msgService.showMsg(\"Sorry\", \"One of the players left the room, you are directed to the room\");\n          this.navCtrl.popTo(\"LobbyPage\");\n        }\n      });\n    }\n  }\n\n  private presentLoading() {\n    this.loader = this.loadingCtrl.create({\n      content: \"Wait till all players vote...\",\n    });\n    this.loader.present();\n  }\n\n  private dismissLoading(){\n    if(this.loader != null)\n      this.loader.dismiss();\n  }\n\n  public LeaveGame() {\n      clearInterval(this.id);\n      if(!this.isSpy) {\n        this.navCtrl.push('EndGamePage', {\n          roundKey: this.roundKey\n        });\n      }\n      else {\n        this.presentLoading();\n      }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/game/game.ts","\"use strict\";\nvar Observable_1 = require('../../Observable');\nvar map_1 = require('../../operator/map');\nObservable_1.Observable.prototype.map = map_1.map;\n//# sourceMappingURL=map.js.map\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/rxjs/add/operator/map.js\n// module id = 469\n// module chunks = 0"],"sourceRoot":""}