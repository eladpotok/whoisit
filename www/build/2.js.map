{"version":3,"sources":["../../src/pages/lobby/lobby.module.ts","../../src/pages/lobby/lobby.ts"],"names":[],"mappings":"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","file":"2.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { LobbyPage } from './lobby';\n\n@NgModule({\n  declarations: [\n    LobbyPage,\n  ],\n  imports: [\n    IonicPageModule.forChild(LobbyPage),\n  ],\n})\nexport class LobbyPageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/lobby/lobby.module.ts","import { Component } from '@angular/core';\nimport { IonicPage, NavController, NavParams } from 'ionic-angular';\nimport { AngularFireDatabase } from 'angularfire2/database';\nimport { Observable } from 'rxjs/Observable';\nimport { UserModel } from '../../Models/user.model';\nimport { RoomModel } from '../../Models/room.model';\nimport { AuthService } from '../../services/auth.service'\nimport { RoomsService } from '../../services/rooms.service';\nimport { RoundModel } from '../../Models/round.model';\nimport { LoadingController } from 'ionic-angular';\n\n@IonicPage()\n@Component({\n  selector: 'page-lobby',\n  templateUrl: 'lobby.html'\n})\nexport class LobbyPage {\n\n  roomKey: string;\n  roomsItems: Observable<RoomModel>;\n  users: Observable<UserModel[]>;\n  isOwner: Boolean;\n  selectorUserKey: string; \n  spyUser: string;\n  roomName: string;\n  usersInRoomKey: string;\n  usersModel: UserModel[] = [];\n  usersCount: number;\n  loader: any;\n  entryCode: string;\n\n  constructor(public navCtrl: NavController, public navParams: NavParams, \n              public af: AngularFireDatabase, private authService: AuthService,\n              private roomService: RoomsService, public loadingCtrl: LoadingController) {\n                \n    console.log(\"enter to lobby ctor\");\n\n    // Get thr paramters from the navigation controller\n    this.roomKey = this.navParams.get('roomKey');\n\n    // load the users from the room\n    this.loadUsers();\n    \n    // find the room by the given entry code\n    this.findRoom();\n\n\n    let subscription = this.af.list(`rounds/${this.roomKey}/`).subscribe(t=>{\n      t.forEach(r=>{\n        if(r != null && r.roomKey == this.roomKey && r.state != \"done\"){\n          let roundKey = r.$key;\n          subscription.unsubscribe();\n          this.af.object(`rounds/${this.roomKey}/${roundKey}/isCategorySelected`).subscribe(category => {\n            if(category.$value){\n              this.dismissLoading();\n              this.navCtrl.push('GamePage', {roundKey: roundKey});\n            }\n          });\n          this.af.object(`rounds/${this.roomKey}/${roundKey}/selectorKey`).subscribe(selector => {\n            if(selector.$value == this.authService.currentUser.$key){\n              this.navCtrl.push('ChooseCategoryPage', {roundKey: roundKey});\n            }\n            else if(selector.$value != null) {\n              this.presentLoading();\n            }\n          });\n        }\n      });\n    });\n  }\n\n  private findRoom(){\n      // Get the current room\n      this.af.object(`/rooms/${this.roomKey}`).subscribe( t=> {\n      this.roomName = t.roomName;\n      if(t.owner == this.authService.currentUser.displayName)\n          this.isOwner = true;\n      else {\n          this.roomService.updateUsersInRoom(this.roomKey);      \n      }\n\n      this.entryCode = t.entryCode;\n    })\n  }\n\n  private loadUsers() {\n      // get the users in the current room\n      this.af.list(`rooms/${this.roomKey}/users`).subscribe( snapshots => {\n        this.usersModel = [];\n        this.usersCount = snapshots.length;\n        snapshots.forEach( snapshot=> {\n          let userId = snapshot.$key;\n          let points = snapshot.$value;\n          \n          this.af.object(`users/${userId}`).subscribe( t=> {\n            t.pointsInRoom = points;\n            this.usersModel.push(t);\n          });\n        });\n      });\n  }\n    \n  private raffleSpy(){ \n     let spyRandNumber = Math.floor(Math.random() * this.usersModel.length );\n     this.spyUser = this.usersModel[spyRandNumber].$key;\n     \n     this.roomService.setSpy(this.spyUser);\n  }\n\n  private raffleSelector(){ \n    \n    let spyRandNumber = Math.floor(Math.random() * this.usersModel.length);\n\n    this.selectorUserKey = this.usersModel[spyRandNumber].$key;\n  }\n  \n  presentLoading() {\n    this.loader = this.loadingCtrl.create({\n      content: \"Please wait...\",\n    });\n    this.loader.present();\n  }\n\n  dismissLoading() {\n    if(this.loader != null)\n      this.loader.dismiss();\n  }\n\n  startGame() {\n      \n      this.roomService.updateUsersInRoom(this.roomKey);\n\n      // raffle spy and category selector  \n      this.raffleSelector(); \n      this.raffleSpy();\n\n      let round: RoundModel = {\n        categoryKey: \"\",\n        selectorKey: this.selectorUserKey,\n        spyKey: this.spyUser,\n        roomKey: this.roomKey,\n        secret: 0\n      }\n\n      this.af.list(`rounds/${this.roomKey}/`).push(round);\n\n      // Add new room to the db\n      this.af.object(`rooms/${this.roomKey}/isStarted`).set(true);\n      this.af.object(`rooms/${this.roomKey}/usersCount`).set(this.usersCount);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/lobby/lobby.ts"],"sourceRoot":""}